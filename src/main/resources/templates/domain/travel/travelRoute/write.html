<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <div class="container">
        <div class="d-flex mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="bi bi-airplane" viewBox="0 0 16 16">
                <path d="M6.428 1.151C6.708.591 7.213 0 8 0s1.292.592 1.572 1.151C9.861 1.73 10 2.431 10 3v3.691l5.17 2.585a1.5 1.5 0 0 1 .83 1.342V12a.5.5 0 0 1-.582.493l-5.507-.918-.375 2.253 1.318 1.318A.5.5 0 0 1 10.5 16h-5a.5.5 0 0 1-.354-.854l1.319-1.318-.376-2.253-5.507.918A.5.5 0 0 1 0 12v-1.382a1.5 1.5 0 0 1 .83-1.342L6 6.691V3c0-.568.14-1.271.428-1.849Zm.894.448C7.111 2.02 7 2.569 7 3v4a.5.5 0 0 1-.276.447l-5.448 2.724a.5.5 0 0 0-.276.447v.792l5.418-.903a.5.5 0 0 1 .575.41l.5 3a.5.5 0 0 1-.14.437L6.708 15h2.586l-.647-.646a.5.5 0 0 1-.14-.436l.5-3a.5.5 0 0 1 .576-.411L15 11.41v-.792a.5.5 0 0 0-.276-.447L9.276 7.447A.5.5 0 0 1 9 7V3c0-.432-.11-.979-.322-1.401C8.458 1.159 8.213 1 8 1c-.213 0-.458.158-.678.599Z"/>
            </svg>
            <h3 class="ml-3">여행 계획</h3>
            <span class="ml-3">여행 일정동안 방문할 장소들을 기록해 보세요</span>
        </div>
        <form th:action="@{/travel/write}" method="post">
            <div class="form-group">
                <label for="title">제목</label>
                <input type="text" class="form-control" id="title" name="title" placeholder="제목을 입력하세요">
            </div>
            <div class="form-group">
                <label for="area">방문 도시</label>
                <input type="text" class="form-control" id="area" name="area" th:value="${area}">
            </div>
            <div class="d-flex">
                <div class="form-group">
                    <label for="startDate">여행 시작 날짜</label>
                    <input type="date" class="form-control" id="startDate" name="startDate"  th:value="${startDate}" style="width: 200px">
                </div>
                <div class="form-group ml-3">
                    <label for="endDate">여행 마지막 날짜</label>
                    <input type="date" class="form-control" id="endDate" name="endDate"  th:value="${endDate}" style="width: 200px">
                </div>
            </div>
            <div class="form-group">
                <label for="body">내용</label>
                <textarea class="form-control" id="body"  name="body" rows="3" placeholder="내용을 입력하세요"></textarea>
            </div>
            <div th:each="day : ${#numbers.sequence(1, days + 1)}">
                <div th:id="'day' + ${day}">
                    <h5>day <span th:text="${day}"></span></h5>
                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" th:attr="data-bs-target='#placeModal' + ${day}">장소 추가하기</button>

                    <div class="modal fade" th:id="'placeModal' + ${day}" role="dialog" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">장소 추가하기</h4>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="close">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <div>
                                        <h5>장소</h5>
                                        <input type="text" th:id="'name' + ${day}" placeholder="장소 이름을 입력하세요">
                                    </div>
                                    <div class="mt-3">
                                        <h5>주소</h5>
                                        <input type="text" th:id="'address' + ${day}" placeholder="주소를 입력하세요">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-info btn-close" data-dismiss="modal" th:onclick="addPlaceField([[${day}]])">추가</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group d-flex justify-content-center">
                <button type="submit" class="btn" mt-4 style="background-color: #00BFFF; color: white;">등록</button>
            </div>
        </form>
    </div>
</div>
<script layout:fragment="script" type="text/javascript">
    var orderPerDay = {};

    function addPlaceField(day) {
        if(!orderPerDay[day]) {
            orderPerDay[day] = 1;
        } else {
            orderPerDay[day]++;
        }

        var container = document.getElementById('day' + day);
        var name = document.getElementById('name' + day).value;
        var address = document.getElementById('address' + day).value;

        var card = document.createElement('div');
        card.className ='card my-3';

        var cardBody = document.createElement('div');
        cardBody.className = 'card-body';
        cardBody.innerHTML = name + '(' + address +')';

        var hiddenTag = document.createElement('input');
        hiddenTag.type = 'hidden';
        hiddenTag.name = 'places';
        hiddenTag.value = day + ',' + orderPerDay[day] + ',' + name + ',' + address;

        card.appendChild(cardBody);
        card.appendChild(hiddenTag);
        container.appendChild(card);

        $('#placeModal' + day).modal('hide');
    }

    $(document).ready(function() {
        $('.modal').on('hidden.bs.modal', function () {
            $(this).find('input[type="text"]').val('');
        });
    });
</script>
</html>